{{page-title "Sources"}}
<DataTable
  class='pt-2'
  @content={{this.model.dataset}}
  @page={{this.page}}
  @size={{this.size}}
  @enableSizes={{false}}
  @noDataMessage="No Sources found"
  as |Table|
>

  <Table.menu as |Menu|>
    <Menu.general class="d-flex flex-row-reverse">
      <BsButton
        @onClick={{this.switchShowAddSource}}
      >
        Add source
      </BsButton>
    </Menu.general>
  </Table.menu>
  <Table.content @class="table table-striped w-100" as |Content|>
    <Content.header>
      <ThSortable @field="url" @currentSorting={{this.sort}} @label="url" />
      <ThSortable @field="type.pref-label" @currentSorting={{this.sort}} @label="Type" />
      <th>Last Update</th>
      <th>Actions</th>
      <th>Alias</th>
    </Content.header>
    <Content.body as |dataset|>
      <td>
        <a href={{dataset.downloadPage}} target="_blank" rel="noopener noreferrer">{{dataset.downloadPage}}</a>
      </td>
      <td>{{dataset.type.prefLabel}}</td>
      <td>
        <DatasetStatus @jobType='vocab-download-job' @dataset={{dataset}} />
      </td>
      <td>
        {{#if (fn this.isDump dataset)}}
        <BsButton
            @type="info"
            @onClick={{perform this.createAndRunDownloadJob dataset}}
          >
            <BsIcon @name="download" />
        </BsButton>
        {{/if}}
        <ConfirmationButton
          @onConfirm={{fn this.deleteDataset dataset}}
          @confirmBtnTxt='Delete'
          @confirmBtnType='danger'
          @type="danger"
        >
          <:message>
            <p>Are you sure you want to delete <strong>{{dataset.downloadPage}}</strong>?</p>
          </:message>
          <:buttonContent>
            <BsIcon @name='trash-fill' />
          </:buttonContent>
        </ConfirmationButton>
      </td>
      <td>
        {{#if (eq this.editableDataset.uri dataset.uri)}}
          <div>
            <BsForm::Element::Control::Input 
              @value={{this.newAlias}}
              @onChange={{this.setNewAlias}}
            />
            <BsButton
                @type="info"
                @onClick={{this.saveDatasetAlias}}
            >
              <BsIcon @name="spellcheck" />
            </BsButton>
            <BsButton
                @type="danger"
                @onClick={{this.stopEditingDataset}}
            >
              <BsIcon @name="x-square" />
            </BsButton>
          </div>
          {{#if this.error}}
            <span class="text-danger">{{this.error}}</span>
          {{/if}}
        {{else}}
          {{or (this.aliasString dataset.alias) "*no alias*"}}
          <BsButton
              @type="info"
              @onClick={{fn this.setDatasetEdit dataset}}
            >
              <BsIcon @name="pencil-square" />
          </BsButton>
        {{/if}}
      </td>
    </Content.body>
  </Table.content>
</DataTable>
{{#if this.showAddSource}}
  <AddSource @onSubmit={{perform this.addSource}} @onClose={{this.switchShowAddSource}}/>
{{/if}}
